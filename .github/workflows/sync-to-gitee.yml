name: Sync to Gitee (HTTPS Only)

on:
  push:
    branches: [ master ]
  workflow_dispatch: # 允许手动点击按钮触发

jobs:
  git-mirror:
    runs-on: ubuntu-latest
    steps:
      # 1. 检出代码（必须下载完整历史，否则无法镜像）
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 2. 直接使用 Git 命令强制推送到 Gitee
      - name: Push to Gitee
        run: |
          # 配置 Gitee 远程地址
          # 注意：这里硬编码了用户名 renleihaokun，请确保 Gitee 上仓库路径正确
          git remote add gitee "https://renleihaokun:${{ secrets.GITEE_TOKEN }}@gitee.com/renleihaokun/${{ github.event.repository.name }}.git"
          
          echo "正在强制推送到 Gitee..."
          
          # 使用 --force --mirror 强制同步所有分支和标签，覆盖远程历史
          git push --force --mirror gitee
